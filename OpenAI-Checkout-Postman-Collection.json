{
  "info": {
    "name": "Agentic Commerce POC - Checkout Sessions API",
    "description": "Postman collection for testing OpenAI Agentic Commerce checkout sessions API. Simulates ChatGPT's shopping flow manually.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "agentic-shop"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "session_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "product_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "order_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "0 - Setup: Get Product ID",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/openai/products",
          "host": ["{{base_url}}"],
          "path": ["api", "openai", "products"]
        },
        "description": "Get the OpenAI product feed to find a valid product ID for testing. Copy the first product's ID to use in the next request."
      }
    },
    {
      "name": "1 - Create Checkout Session",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"items\": [\n    {\n      \"sku\": \"{{product_id}}\",\n      \"quantity\": 1\n    }\n  ],\n  \"shipping_address\": {\n    \"postal_code\": \"0550\",\n    \"country\": \"NO\"\n  },\n  \"currency\": \"NOK\",\n  \"idempotency_key\": \"test-{{timestamp}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/api/openai/checkout_sessions",
          "host": ["{{base_url}}"],
          "path": ["api", "openai", "checkout_sessions"]
        },
        "description": "Create a new checkout session (like ChatGPT does when user starts shopping). Copy the session ID from response."
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.collectionVariables.set(\"session_id\", pm.response.json().id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "2 - Update Session (Change Quantity)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"items\": [\n    {\n      \"sku\": \"{{product_id}}\",\n      \"quantity\": 2\n    }\n  ]\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/api/openai/checkout_sessions/{{session_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "openai", "checkout_sessions", "{{session_id}}"]
        },
        "description": "Update the checkout session to change quantity (like when user says 'I want 2 instead')."
      }
    },
    {
      "name": "3 - Update Session (Select Express Shipping)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"shipping_option\": \"express\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/api/openai/checkout_sessions/{{session_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "openai", "checkout_sessions", "{{session_id}}"]
        },
        "description": "Update the checkout session to select express shipping (like when user wants faster delivery)."
      }
    },
    {
      "name": "4 - Update Session (Change Address)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"shipping_address\": {\n    \"postal_code\": \"0010\",\n    \"country\": \"NO\"\n  }\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/api/openai/checkout_sessions/{{session_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "openai", "checkout_sessions", "{{session_id}}"]
        },
        "description": "Update the checkout session shipping address (like when user updates their location)."
      }
    },
    {
      "name": "5 - Complete Order",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"test.customer@postman.com\",\n  \"name\": \"Postman Test User\"\n  // Note: In real ChatGPT, payment_token would come from delegated payment\n  // For POC testing, this creates a Stripe checkout session URL\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/api/openai/checkout_sessions/{{session_id}}/complete",
          "host": ["{{base_url}}"],
          "path": ["api", "openai", "checkout_sessions", "{{session_id}}", "complete"]
        },
        "description": "Complete the checkout session (like when user confirms purchase). Creates order and returns payment URL."
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.collectionVariables.set(\"order_id\", pm.response.json().order_id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "6 - Verify Order Created",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/orders?email=test.customer@postman.com",
          "host": ["{{base_url}}"],
          "path": ["api", "orders"],
          "query": [
            {
              "key": "email",
              "value": "test.customer@postman.com"
            }
          ]
        },
        "description": "Verify the order was created in the database (check orders by customer email)."
      }
    },
    {
      "name": "7 - View Order Details",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/orders/{{order_id}}",
          "host": ["{{base_url}}"],
          "path": ["orders", "{{order_id}}"]
        },
        "description": "View the complete order details (optional - for verification)."
      }
    }
  ]
}
